= javascript_include_tag "https://www.google.com/jsapi"
#manager
	#feed_container.span10
		#wrapper.span9
			/= render :partial => "account_info"

			#feed.row
				#left_column.span3.hidden-phone
					%ul.nav.nav-tabs.nav-stacked
						%li
							.box.top Inbox
						%li{:class => "#{'active' if params[:filter] == 'linked'}"}= link_to "Linked Posts (#{@linked_box_count})", '?filter=linked'
						%li{:class => "#{'active' if params[:filter] == 'unlinked'}"}= link_to "Unlinked Posts (#{@unlinked_box_count})", '?filter=unlinked'

						%li
							.box Quality control
							%li{:class => "#{'active' if params[:filter].nil?}"}= link_to "Autocorrected (#{@autocorrected_box_count})", '?'
							%li{:class => "#{'active' if params[:filter] == 'spam'}"}= link_to "Spam", '?filter=spam'

						%li
							.box Tags
						%li{:class => "#{'active' if params[:filter] == 'ugc'}"}= link_to "User Generated Questions", '?filter=ugc'
						%li{:class => "#{'active' if params[:filter] == 'retweets'}"}= link_to "Retweets", '?filter=retweets'
						%li{:class => "#{'active' if params[:filter] == 'spam'}"}= link_to "Spam", '?filter=spam'
						%li{:class => "#{'active' if params[:filter] == 'content'}"}= link_to "Content Suggestions", '?filter=content'
						%li{:class => "#{'active' if params[:filter] == 'friend'}"}= link_to "Ask a Friend", '?filter=friend'
						- if @oneinbox
							%li{:class => "#{'active' if params[:filter] == 'tutor'}"}= link_to "Tutor", '?filter=tutor'
						/ - @tags.each do |tag|
						/ 	%li{:class => "#{'active' if params[:filter] == tag.name}"}= link_to tag.name, "?filter=#{tag.name}"
						//%li= link_to "Starred", '?filter=starred'

					%ul.nav.nav-tabs.nav-stacked.stats
						%li
							.box.top Auto vs App vs Manual grade
						%li
							#autograder-auto-stats.graph

					%ul.nav.nav-tabs.nav-stacked.stats
						%li
							.box.top Incorrect vs Correct grade
						%li
							#autograder-correct-stats.graph

					#send_tweet.rounded.border-color{style: ("display:none;" if @oneinbox)}
						.header
							%h4 Post as Asker			
							/ .message_type.btn-group{"data-toggle" => "buttons-radio"}
							/ 	%button.btn.correct.active Mention
							/ 	%button.btn.incorrect DM	
						.question_container.blur
							%textarea
							%p.ask_success.hide
								Your comment was posted! 
								%a.ask_again Post another →
								/ or
								/ %a.post_url{:target => "_blank"}
								/ 	see it on Twitter →
							.tweet_button.btn.btn-primary Tweet
							.character_count 140															

				#right_column.span6
					#posts.rounded
						.header.border-color
							%h3
								= @asker.twi_screen_name
								/ .btn-group
								/ 	%a.btn.btn-small{:href => "/askers/#{@asker.id}/hide_all/#{@posts.collect(&:id).join('+')}"} Hide all
							
						- asker_collection = User.askers.collect {|a| [a.id, a.twi_screen_name]}
						- unresponded_unlinked_count = unresponded_linked_count = autocorrect_count = 0
						- @engagements.each do |id, post|

							/ quick reply vars
							- correct = nil
							- if params[:filter] != 'ugc' and question = post.in_reply_to_question
								- correct = question.answers.reject{|a| a.correct != true}[0]
							/ - if params[:filter] != 'ugc'
							/ 	- question = (post.is_dm? ? post.parent.question : post.in_reply_to_question)
							/ 	- if question
							/ 		- correct = question.answers.reject{|a| a.correct != true}[0]
							.conversation.border-color{class: ('dim' if params[:filter] == 'tutor' and Asker.ids.include?(post.user_id))}
								.post.parent.answered{:post_id => post.id, :interaction_type => post.interaction_type}
									%p.time= time_formatter(post.created_at)
									%i.icon-share-alt{:style => "display: none;"}
									- if params[:filter] == 'ugc' and Asker.ids.include? @conversations[id][:posts].select{|p| p.intention.blank?}.first.in_reply_to_user_id
										%i.icon-comment{:style => "color: #4d90f0;"}
									.content
										= image_tag(post.user.twi_profile_img_url, :class => "rounded")
										%i{:class => interaction_icon(post.interaction_type)}
										%h5
											%span= post.user.twi_screen_name	
										- if @oneinbox
											→ #{@askers_by_id[post.in_reply_to_user_id]}

										%p= post.text.gsub(/<|>/, '').gsub(/@[a-zA-Z0-9_]+ /, '').html_safe
										- if correct
											%p.quick-reply
												%span{style: 'opacity:0.6;'}
													= correct.text

									- if params[:filter] == 'ugc'
										= render :partial => "ugc_actions", :locals => {:post => post}
									- else
										= render :partial => "default_actions", :locals => {:post => post, :question => question}

					/ - if ['spam', 'tutor'].include? params[:filter]
					.pagination-wrapper
						= paginate @posts

= render :partial => "retweet_modal"
= render :partial => "respond_modal"
= render :partial => "question_modal"
/ = render :partial => "link_post_modal"

#confirm.modal.hide
	.modal-header
		%button.close{:type => "button", "data-dismiss" => "modal", "aria-hidden" => "true"} &times;
		%h3 Confirm
	.modal-body
		Are you sure you want to unlink this post?							
	.modal-footer
		%a.btn{:type => "button", "data-dismiss" => "modal", "aria-hidden" => "true"} Close
		%a#unlink_post.btn.btn-primary Unlink Post

#post_template.conversation.border-color{:style => "display: none;"}
	.post.parent
		%i.icon-share-alt{:style => "display: none;"}
		.content
			= image_tag(@asker.twi_profile_img_url, :class => "rounded")
			%h5= @asker.twi_screen_name
			%p Post content
		.answers.rounded.border{:style => "display: none;"}
	.subsidiaries{:style => "display: none;"}
	.loading{:style => "display: none;"}
		Loading...

#answer_template.answer_container.input{:type => 'text', :style => "display: none;"}
	.shadow-top
	.tweet
		%span#account= "@#{@asker.twi_screen_name}"
		%span#answer= " Answer text"
		%span#url= " URL"
		/ %span#additional{:contenteditable => true}
	.answer_controls
		.tweet_button.btn.btn-primary Tweet!
	.shadow-bottom

#subsidiary_template.post{:style => "display: none;"}
	%time.timeago
	.content
		= image_tag(@asker.twi_profile_img_url, :class => "rounded")							
		%h5= "User Name"
		%p= "Post content"

= hidden_field_tag :feed_id, @asker.id
= hidden_field_tag :feed_name, @asker.twi_screen_name
= hidden_field_tag :conversations, @conversations.to_json
= hidden_field_tag :engagements, @engagements.to_json
= hidden_field_tag :user_name, current_user.twi_screen_name if current_user
= hidden_field_tag :user_img, current_user.twi_profile_img_url if current_user

= hidden_field_tag :correct_responses, CORRECT.to_json
= hidden_field_tag :correct_complements, COMPLEMENT.to_json
= hidden_field_tag :feed_id, @asker.id
